<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.14 (Pod::Simple 3.07, Perl::Tidy 20031021) on 2008-12-13 22:51:07 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2008 Perl Advent Calendar: For Krismash, I wante a pony (pleez)</title>
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="mod13.pod" />
</head>
<body>
<h1><a href="../">Perl Advent Calendar 2008-12</a>-13</h1>
<h2 align="center">For Krismash, I wante a pony (pleez)</h2>
<h3 align="center">by Yanick Champoux</h3>

<p>Gluggag&aelig;gir (Glugg to his friends) has been employed by the North Pole for a long, long time. Although he started his career as a modest candy cane painter, he worked his way steadily up the Elvin professional ladder along the years. Reindeer wrangler, eggnog tester, rubber duck tuner, cookie engineer, he's done it all. And right now he's enjoying what he thinks is his funniest job so far: member of the North Pole elite IT staff.</p>
<p>It's under that function that, a few weeks ago, he got briefed about a skunk work project commissioned by the Big Red himself. Although he's not at liberty to reveal much information about it at the moment, let's just say that it has to do with children letters. His part of the project was to come up with a way to automatically spellcheck those letters.</p>
<p><span style="font-style: italic">No problem</span>, he thought. He was going to use <tt><a href="http://search.cpan.org/perldoc?Text::SpellChecker">Text::SpellChecker</a></tt>, a nice wrapper around <tt><a href="http://search.cpan.org/perldoc?Text::Aspell">Text::Aspell</a></tt> that&mdash;among other things&mdash; provides context and globally replaces words. And, indeed, a few typed lines later, he was happily sending in his brand new script to be added to the North Pole production system.</p>
<p>And that's when the cookie dough hit the Christmas wreath. Poor Glugg, it turned out, had overlooked two things...</p>
<p>The first was a internal detail of <tt>Text::SpellChecker</tt>: the module creates a new instance of a <tt>Text::Aspell</tt> object each time it spellcheck a word. Not a big deal if one goes through a single text, a much bigger deal if one deals with a system processing the letters of all the children of the world. The system, as it was, just wasn't optimized enough.</p>
<p>But the second problem was, by far, the worst. Although the children's letters were written in all languages, <tt>Text::SpellChecker</tt> objects couldn't be configured away from the default. The way Glugg implemented his script, the wishes of all non-English speaking children would be "corrected" into gibberish. Catastrophe!</p>
<p>Needless to say, Glugg was deeply ashamed of the high-handed way he dealt with his part of the project. Now in full knowledge of his requirements, and pitfalls of his first solution, he retreated to his gingerbread cube and <a href="patch">hacked</a><sup><a href="#footnotert">1</a></sup> at <tt>Text::SpellChecker</tt> till he got it working just the way he wanted. Which, happily enough, didn't take too long. He even had the time to add the functionality developed by his colleague Fr&oacute;dusleikir to <a href="../../2008/4/">auto-detect a letter's language</a>.</p>

<img src="letter-fr-613598.jpg" width="255" style="float:right">

<pre>$ spellomatic < letter-61358.txt<span class="c">

--- original letter:

Cher Papa Noel,

Comme cadaut, je veux un gros camion jaune.

Bisoux,
Martin

--- corrected letter:

Cher Papa No&euml;l,

Comme cadeau, je veux un gros camion jaune.

Bisou,
Martin</span></pre>
<p>Once again, everything was well with the North Pole computer systems. And now that Glugg's part of the project was up and running, it was time to execute the next step of Santa's secret project. But this, boys and girls, is a story for another day...</p>
<a name="mod13.pl" id="mod13.pl"></a><h2><a href="mod13.pl">mod13.pl</a></h2><pre>
   1 #!/usr/bin/perl 
   2 
   3 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
   4 <span class="k">use</span> <span class="w">warnings</span><span class="sc">;</span>
   5 
   6 <span class="k">use</span> <span class="w">Text::SpellChecker</span><span class="sc">;</span>
   7 <span class="k">use</span> <span class="w">Lingua::Ident</span><span class="sc">;</span>
   8 
   9 <span class="k">my</span> <span class="i">$letter</span> = <span class="k">join</span> <span class="q">''</span><span class="cm">,</span> &lt;&gt;<span class="sc">;</span>
  10 
  11 <span class="k">print</span> <span class="q">&quot;--- original letter:\n\n$letter\n\n&quot;</span><span class="sc">;</span>
  12 
  13 <span class="c"># TODO: add all the languages of the world. -- Glugg</span>
  14 <span class="k">my</span> <span class="i">$ident</span> = <span class="w">Lingua::Ident</span><span class="w">-&gt;new</span><span class="s">(</span> <span class="k">map</span> <span class="q">&quot;data.$_&quot;</span> <span class="cm">=&gt;</span> <span class="q">qw/ en fr de /</span> <span class="s">)</span><span class="sc">;</span>
  15 
  16 <span class="k">my</span> <span class="i">$speller</span> = <span class="w">Text::SpellChecker</span><span class="w">-&gt;new</span><span class="s">(</span>
  17     <span class="w">text</span> <span class="cm">=&gt;</span> <span class="i">$letter</span><span class="cm">,</span>
  18     <span class="w">lang</span> <span class="cm">=&gt;</span> <span class="i">$ident</span><span class="i">-&gt;identity</span><span class="s">(</span><span class="i">$letter</span><span class="s">)</span><span class="cm">,</span>
  19 <span class="s">)</span><span class="sc">;</span>
  20 
  21 <span class="k">while</span> <span class="s">(</span> <span class="k">my</span> <span class="i">$word</span> = <span class="i">$speller</span><span class="i">-&gt;next_word</span> <span class="s">)</span> <span class="s">{</span>
  22             <span class="c"># just take the first suggestion,</span>
  23             <span class="c"># if there is one</span>
  24     <span class="k">my</span> <span class="s">(</span><span class="i">$corrected</span><span class="s">)</span> = <span class="i">$speller</span><span class="i">-&gt;suggestions</span><span class="sc">;</span>
  25     <span class="c">#Bonus feature</span>
  26     <span class="i">$speller</span><span class="i">-&gt;replace_all</span><span class="s">(</span> <span class="w">new_word</span> <span class="cm">=&gt;</span> <span class="i">$corrected</span> <span class="s">)</span> <span class="k">if</span> <span class="i">$corrected</span><span class="sc">;</span>
  27 <span class="s">}</span>
  28 
  29 <span class="k">print</span> <span class="q">&quot;--- corrected letter:\n\n&quot;</span><span class="cm">,</span> <span class="i">$speller</span><span class="i">-&gt;text</span><span class="cm">,</span> <span class="q">&quot;\n\n&quot;</span><span class="sc">;</span>
  30 
<a name="__END__"></a>  31 <span class="k">__END__</span>
</pre>
<a name="footnotert">1.</a> &hellip;and submitted it to <a href="http://rt.cpan.org/Public/Bug/Display.html?id=41685">RT</a> of course.
<div style="float: right; font-size: 10pt"><a href="mod13.pod">View Source (POD)</a></div><br />
</body>
</html>
